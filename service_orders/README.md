# Orders Service

Сервис для управления заказами в системе.

## Модель заказа

Каждый заказ содержит:
- **ID** - уникальный идентификатор (UUID)
- **User ID** - идентификатор пользователя (UUID)
- **Items** - массив товаров в формате JSON
- **Status** - статус заказа (создан/в_работе/выполнен/отменён)
- **Total Amount** - итоговая сумма заказа
- **Created At** - дата создания
- **Updated At** - дата последнего обновления

### Формат товара в заказе

```json
{
  "name": "Название товара",
  "amount": 2,
  "description": "Описание товара",
  "price": 100.50
}
```

## Функционал

Все эндпоинты доступны только авторизованным пользователям.

### Endpoints

1. **POST /v1/orders/** - Создание нового заказа
   - Автоматически вычисляет итоговую сумму
   - Проверяет валидность данных товаров

2. **GET /v1/orders/{order_id}** - Получение заказа по ID
   - Доступ только к собственным заказам

3. **GET /v1/orders/** - Список заказов текущего пользователя
   - Поддержка пагинации
   - Фильтрация по статусу
   - Сортировка по полям: created_at, updated_at, total_amount
   - Направление сортировки: asc, desc

4. **PATCH /v1/orders/{order_id}/status** - Обновление статуса заказа
   - Проверка прав доступа
   - Валидация изменения статуса

5. **DELETE /v1/orders/{order_id}** - Отмена заказа
   - Изменяет статус на "отменён"
   - Нельзя отменить завершенные заказы

## Установка и запуск

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Настройте переменные окружения:
```bash
cp .env.example ../.env
# Отредактируйте ../.env файл с вашими настройками
```

3. Запустите сервис:
```bash
python main.py
```

Сервис будет доступен по адресу: http://localhost:8002

## Документация API

После запуска сервиса документация доступна по адресам:
- Swagger UI: http://localhost:8002/docs
- ReDoc: http://localhost:8002/redoc

## Авторизация

Для доступа к API необходимо передавать JWT токен в заголовке:
```
Authorization: Bearer <your_jwt_token>
```

JWT токен можно получить через сервис аутентификации (service_users).

## Важно

- Файл `.env` должен находиться на уровень выше директории `service_orders`
- JWT_SECRET_KEY должен совпадать с тем, что используется в service_users
- Проверка прав выполняется на уровне сервиса
- Пользователи могут работать только со своими заказами
